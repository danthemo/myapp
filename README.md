# Практическое занятие 2
Ходыч Даниил Евгеньевич

ЭФМО-02-25

## Что это?
Простой HTTP-сервер, демонстрирующий базовую структуру Go-проекта. Содержит несколько эндпоинтов для проверки работы сервера.

## Пререквизиты:
1. **Go** (версии 1.21 или выше)
2. **Git**

## Как запустить:
1.  **Клонируйте репозиторий**
    ```Bash
    git clone https://github.com/danthemo/myapp.git
    ```

2.  **Перейдите в директорию проекта**
    ```Bash
    cd ./myapp
    ```

3.  **Запустите сервер командой:**
    ```bash
    go run ./cmd/myapp
    ```
4.  **Сервер будет доступен по адресу:** http://localhost:8080
    <img width="624" height="48" alt="image" src="https://github.com/user-attachments/assets/1e4a67d3-4a5f-4800-bd03-9f52236cc2dc" />

## Использование:
Для браузера:
- http://localhost:8080 - выводит простой текстовый ответ
- http://localhost:8080/ping - выводит JSON-ответ со статусом и временем
- http://localhost:8080/fail - выводит JSON-ошибку

Для curl:

- Текстовый ответ:
    ```Bash
    curl -i http://localhost:8080
    ```
    <img width="519" height="152" alt="image" src="https://github.com/user-attachments/assets/6c0aac2a-fd69-4369-b9f5-ce20a3a5945e" />

- JSON-ответ со статусом и временем:
    ```Bash
    curl -i http://localhost:8080/ping
    ```
    <img width="555" height="155" alt="image" src="https://github.com/user-attachments/assets/305a7873-9cf8-402f-93bf-918a1c272550" />

- JSON-ошибка:
    ```Bash
    curl -i http://localhost:8080/fail
    ```
    <img width="559" height="150" alt="image" src="https://github.com/user-attachments/assets/fbf0ce4f-5d5e-45d1-905e-1e9fb46649bd" />

- Чтобы передать заголовок `X-Request-Id` - указываем его в curl:
    ```Bash
    curl -i -H "X-Request-Id: demo-123" http://localhost:8080
    ```
    <img width="689" height="174" alt="image" src="https://github.com/user-attachments/assets/50df2970-7f07-4fb7-9ece-f123de794ffa" />
    >Если не передать заголовок `X-Request-Id` - он будет сегенерирован автоматически

## Логирование в консоль:
<img width="602" height="142" alt="image" src="https://github.com/user-attachments/assets/931bded3-fb2d-4d6a-95c9-3f4dfe2c8c0b" />


## Структура проекта:
<img width="247" height="373" alt="image" src="https://github.com/user-attachments/assets/503421ee-493a-4ba6-9b1c-2b27dd5a5161" />




## Описание файлов проекта:

### 1. `go.mod`
Файл модуля Go. Определяет имя модуля и версию Go, управляет зависимостями.

### 2. `main.go`
Точка входа в приложение. Минимальный код, который только запускает основную логику.

### 3. `app.go`
Создает HTTP-сервер, настраивает маршруты и middleware.
- Создает роутер (http.NewServeMux)
- Регистрирует обработчики для путей /, /ping, /fail
- Добавляет middleware для Request-ID
- Запускает сервер на порту 8080

### 4. `ping.go`
Обработчик эндоинта `/ping`

### 5. `logger.go`
Вспомогательная функция для логирования
- `LogRequest()` - логирование входящих запросов
- `LogError()` - ошибки
- `NewId16()` - генерация уникальных ID для запросов

### 6. `httpjson.go`
Вспомогательные функции для работы в HTTP с JSON
- `WriteJSON()` - отправка JSON ответа
- `WriteErr()` - отправка JSON ошибки

# Артефакты и их расположение:
В ходе работы были созданы следующие артефакты:

1. `main.go` -> `/cmd/myapp/` - Точка входа приложения. Согласно стандартной структуре Go-проекта, исполняемые файлы располагаются в `cmd/`, каждый в своей подпапке. Это делает очевидным, где находится вход в программу.

2. `app.go` -> `/internal/app/` - Этот файл содержит основную логику приложения: создание HTTP-сервера, роутинг, middleware. Код, который не должен импортироваться другими модулями, принадлежит `internal/`. Размещение в `internal/app/` дополнительно организует код по функциональному признаку.

3. `ping.go` -> `/internal/app/handlers/` - Обработчики HTTP-запросов - это часть логики приложения, но их логично отделить от кода инициализации сервера. Вынос в подпапку `handlers/` улучшает структуру, группируя схожие сущности, и облегчает навигацию по проекту, когда эндпоинтов станет много.

4. `logger.go` -> `/utils/` - Это вспомогательная утилита, используемая разными частями приложения. Размещение в `utils/` указывает на её вспомогательную, а не основную роль.

5. `httpjson.go` -> `/utils/` - Так же, как и логгер, это вспомогательная утилита для работы с HTTP. Её назначение - предоставлять общие функции для форматирования JSON-ответов. Размещение в той же папке `utils/` группирует весь вспомогательный код в одном месте, избегая его разброса.

# Ответы на вопросы:
1. `internal/` и `pkg/`:

    `internal/` - приватный код, нельзя импортировать из других модулей. Для внутренней логики приложения.

    `pkg/` - публичный код, можно импортировать другими модулями. Для библиотек и утилит общего назначения.
    
    Когда использовать: `internal/` - для всего специфичного под проект; `pkg/` - только для кода, предназначенного для повторного использования.

2. Почему много пакетов - вредно:

    Главная опасность - циклические импорты. Усложняет навигацию и понимание кода.

    Как избегать: группировать по функциональности, а не по типам; избегать мелких пакетов-утилит; использовать internal для изоляции.

3. Зачем `api/` отдельно от хендлеров:

    `api/` содержит контракты: OpenAPI, protobuf, JSON-схемы.

    `internal/` содержит реализацию (как): код хендлеров.

    Причины: разделение ответственности; независимое развитие контракта и реализации.

4. Почему `src/` - плохая идея:

    Создает избыточную вложенность (myproject/src/...).

    Нарушает современные стандарты сообщества (плоская структура с cmd/, internal/, pkg/ в корне), что приводит к путаннице с устаревшей системой GOPATH, которую Go modules заменили.

    Усложняет инструментам (IDE, компилятору) разрешение импортов.
